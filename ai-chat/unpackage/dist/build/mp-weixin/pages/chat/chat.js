"use strict";const s=require("../../utils/wenxin-service.js"),t=require("../../utils/storage.js"),e=require("../../common/vendor.js"),i={data:()=>({chatList:[],inputMessage:"",scrollTop:0,scrollToView:"",messageHistory:[]}),onLoad(){const{chatList:s,messageHistory:e}=t.loadChatHistory();this.chatList=s,this.messageHistory=e,this.$nextTick((()=>{this.scrollToBottom()}))},methods:{async sendMessage(){if(!this.inputMessage.trim())return;const e={type:"user",content:this.inputMessage};this.chatList.push(e),this.messageHistory.push({role:"user",content:this.inputMessage}),this.inputMessage="";this.chatList.push({type:"ai",content:"正在思考..."});try{const e=await s.chatWithWenxin(this.messageHistory);this.messageHistory.push({role:"assistant",content:e}),this.chatList[this.chatList.length-1]={type:"ai",content:e},t.saveChatHistory(this.chatList,this.messageHistory)}catch(i){this.chatList[this.chatList.length-1]={type:"ai",content:"抱歉，发生了错误，请稍后重试。"},this.messageHistory.pop()}this.scrollToBottom()},scrollToBottom(){setTimeout((()=>{this.scrollToView="msg-"+(this.chatList.length-1)}),100)}}};if(!Array){(e.resolveComponent("path")+e.resolveComponent("svg"))()}const o=e._export_sfc(i,[["render",function(s,t,i,o,a,n){return{a:e.f(a.chatList,((s,t,i)=>({a:e.t(s.content),b:e.n("user"===s.type?"user-message":"ai-message"),c:t,d:"msg-"+t}))),b:a.scrollTop,c:a.scrollToView,d:e.o(((...s)=>n.sendMessage&&n.sendMessage(...s))),e:a.inputMessage,f:e.o((s=>a.inputMessage=s.detail.value)),g:e.p({d:"M512 64C264.576 64 64 264.576 64 512s200.576 448 448 448 448-200.576 448-448S759.424 64 512 64z m214.679 406.679c-12.427 12.428-32.763 12.428-45.191 0L544 333.191V768c0 17.6-14.4 32-32 32s-32-14.4-32-32V333.191L342.511 470.679c-12.427 12.427-32.763 12.427-45.191 0-12.427-12.427-12.427-32.763 0-45.191l190.216-190.216a32.325 32.325 0 0 1 1.784-1.952c6.225-6.225 14.434-9.331 22.639-9.32l0.04-0.001 0.04 0.001c8.205-0.011 16.414 3.095 22.639 9.32a32.026 32.026 0 0 1 1.784 1.952l190.216 190.216c12.429 12.428 12.429 32.764 0.001 45.191z","p-id":"6666",fill:"#cdcdcd"}),h:e.p({t:"1738750502016",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"6665",width:"32",height:"32"}),i:e.o(((...s)=>n.sendMessage&&n.sendMessage(...s)))}}]]);wx.createPage(o);
