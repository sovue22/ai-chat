import{r as s,s as t,g as e,c as a,w as o,i as c,o as i,a as n,b as r,d as l,F as h,e as p,S as u,I as d,f as g,n as m,h as y,t as f,j as w}from"./index-B8-Nm2S9.js";const _="KQaNGjrETpn2xqJPDCllA9SN",T="K3x6bB1O0WJN1dNXt5wAnfHHe7pJqcKP";const k=new class{constructor(){this.accessToken=""}getPlatform(){return"h5"}getBaseUrl(){return"h5"===this.getPlatform()?"/api":"https://aip.baidubce.com"}async getAccessToken(){try{const t=`${this.getBaseUrl()}/oauth/2.0/token?grant_type=client_credentials&client_id=${_}&client_secret=${T}`,{data:e}=await s({url:t,method:"POST",header:{"Content-Type":"application/json",Accept:"application/json"}});if(e.access_token)return this.accessToken=e.access_token,this.accessToken;throw new Error("获取access_token失败")}catch(t){throw console.error("获取access_token错误:",t),t}}async chat(t){try{this.accessToken||await this.getAccessToken();const e=`${this.getBaseUrl()}/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/completions?access_token=${this.accessToken}`,{data:a}=await s({url:e,method:"POST",header:{"Content-Type":"application/json"},data:{messages:t}});if(a.error_code){if(110===a.error_code||111===a.error_code)return this.accessToken="",this.chat(t);throw new Error(a.error_msg)}return a.result}catch(e){throw console.error("调用文心一言API错误:",e),e}}};const L=((s,t)=>{const e=s.__vccOpts||s;for(const[a,o]of t)e[a]=o;return e})({data:()=>({chatList:[],inputMessage:"",scrollTop:0,scrollToView:"",messageHistory:[]}),onLoad(){const{chatList:s,messageHistory:t}=function(){try{return{chatList:JSON.parse(e("chatList")||"[]"),messageHistory:JSON.parse(e("messageHistory")||"[]")}}catch(s){return console.error("读取聊天记录失败:",s),{chatList:[],messageHistory:[]}}}();this.chatList=s,this.messageHistory=t,this.$nextTick((()=>{this.scrollToBottom()}))},methods:{async sendMessage(){if(!this.inputMessage.trim())return;const s={type:"user",content:this.inputMessage};this.chatList.push(s),this.messageHistory.push({role:"user",content:this.inputMessage}),this.inputMessage="";this.chatList.push({type:"ai",content:"正在思考..."});try{const s=await(e=this.messageHistory,k.chat(e));this.messageHistory.push({role:"assistant",content:s}),this.chatList[this.chatList.length-1]={type:"ai",content:s},function(s,e){try{t("chatList",JSON.stringify(s)),t("messageHistory",JSON.stringify(e))}catch(a){console.error("保存聊天记录失败:",a)}}(this.chatList,this.messageHistory)}catch(a){this.chatList[this.chatList.length-1]={type:"ai",content:"抱歉，发生了错误，请稍后重试。"},this.messageHistory.pop()}var e;this.scrollToBottom()},scrollToBottom(){setTimeout((()=>{this.scrollToView="msg-"+(this.chatList.length-1)}),100)}}},[["render",function(s,t,e,_,T,k){const L=w,H=c,M=u,v=d,S=g;return i(),a(H,{class:"chat-container"},{default:o((()=>[n(M,{class:"chat-list","scroll-y":"true","scroll-top":T.scrollTop,"scroll-into-view":T.scrollToView,"scroll-with-animation":!0},{default:o((()=>[(i(!0),r(h,null,l(T.chatList,((s,t)=>(i(),a(H,{class:"chat-item",key:t,id:"msg-"+t},{default:o((()=>[n(H,{class:m(["message","user"===s.type?"user-message":"ai-message"])},{default:o((()=>[n(L,null,{default:o((()=>[y(f(s.content),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1032,["id"])))),128))])),_:1},8,["scroll-top","scroll-into-view"]),n(H,{class:"input-area"},{default:o((()=>[n(v,{class:"message-input",modelValue:T.inputMessage,"onUpdate:modelValue":t[0]||(t[0]=s=>T.inputMessage=s),placeholder:"请输入消息",onConfirm:k.sendMessage},null,8,["modelValue","onConfirm"]),n(S,{class:"send-btn",onClick:k.sendMessage},{default:o((()=>[(i(),r("svg",{t:"1738750502016",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"6665",width:"32",height:"32"},[p("path",{d:"M512 64C264.576 64 64 264.576 64 512s200.576 448 448 448 448-200.576 448-448S759.424 64 512 64z m214.679 406.679c-12.427 12.428-32.763 12.428-45.191 0L544 333.191V768c0 17.6-14.4 32-32 32s-32-14.4-32-32V333.191L342.511 470.679c-12.427 12.427-32.763 12.427-45.191 0-12.427-12.427-12.427-32.763 0-45.191l190.216-190.216a32.325 32.325 0 0 1 1.784-1.952c6.225-6.225 14.434-9.331 22.639-9.32l0.04-0.001 0.04 0.001c8.205-0.011 16.414 3.095 22.639 9.32a32.026 32.026 0 0 1 1.784 1.952l190.216 190.216c12.429 12.428 12.429 32.764 0.001 45.191z","p-id":"6666",fill:"#cdcdcd"})]))])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-f5c6fc86"]]);export{L as default};
